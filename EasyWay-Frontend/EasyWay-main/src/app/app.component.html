<div class="container">
  <header class="header">
    <h1>Easy Way Inventarios</h1>
  </header>

  <main>
    <!-- AGREGAR PRODUCTO -->
    <section class="card">
      <h2>Agregar Producto</h2>

      <form (ngSubmit)="agregarProducto(productoForm)" #productoForm="ngForm" class="form-grid">
        <div class="form-group">
          <label>Nombre</label>
          <input
            type="text"
            [(ngModel)]="nuevoProducto.nombre"
            name="nombre"
            required
            minlength="4"
            #nombre="ngModel"
          />
        </div>

        <div class="form-group">
          <label>Precio Compra</label>
          <input
            type="number"
            [(ngModel)]="nuevoProducto.precioCompra"
            name="precioCompra"
            required
          />
        </div>

        <div class="form-group">
          <label>Precio Venta</label>
          <input
            type="number"
            [(ngModel)]="nuevoProducto.precioVenta"
            name="precioVenta"
            required
          />
        </div>

        <div class="form-group">
          <label>Secci贸n</label>
          <input
            type="text"
            [(ngModel)]="nuevoProducto.seccion"
            name="seccion"
            required
            minlength="4"
            #seccion="ngModel"
          />
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-success" [disabled]="!productoForm.form.valid">
            Agregar
          </button>
        </div>
      </form>

      <!-- Validaciones -->
      <div class="alerta" *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)">
        <div *ngIf="nombre.errors?.['required']">El nombre del producto es obligatorio.</div>
        <div *ngIf="nombre.errors?.['minlength']">
          Nombre del producto es demasiado corto (m铆nimo 4 caracteres).
        </div>
      </div>

      <div class="alerta" *ngIf="seccion.invalid && (seccion.dirty || seccion.touched)">
        <div *ngIf="seccion.errors?.['required']">El nombre de la secci贸n es obligatorio.</div>
        <div *ngIf="seccion.errors?.['minlength']">
          Nombre de la secci贸n es demasiado corto (m铆nimo 4 caracteres).
        </div>
      </div>

      <div class="alerta-success mt-3" *ngIf="mensajeExito">
        {{ mensajeExito }}
      </div>
    </section>

    <!-- BUSCAR PRODUCTO -->
    <section class="card">
      <h2>Buscar Producto</h2>

      <div class="search-bar">
        <input type="number" [(ngModel)]="busquedaId" name="busquedaPorId" placeholder="Ingrese ID" />
        <button (click)="buscarProducto()" class="btn btn-primary">Buscar</button>
      </div>

      <div class="search-bar">
        <input type="text" [(ngModel)]="busquedaNombre" name="busquedaPorNombre" placeholder="Ingrese Nombre" />
        <button (click)="buscarProductoPorNombre(busquedaNombre)" class="btn btn-primary">Buscar</button>
      </div>

      <div class="search-bar">
        <input type="text" [(ngModel)]="busquedaSeccion" name="busquedaPorSeccion" placeholder="Ingrese Secci贸n" />
        <button (click)="buscarProductosPorSeccion(busquedaSeccion)" class="btn btn-primary">Buscar</button>
      </div>

      <div *ngIf="mensajeNoEncontrado" class="alert alert-warning" role="alert">
        {{ mensajeNoEncontrado }}
      </div>

      <!-- Tabla de resultados -->
      <div
        *ngIf="productosFiltrados?.length > 0 && (lastBusquedaSeccion || lastBusquedaNombre)"
        class="result table-container"
      >
        <h3>
          Resultados para
          "{{ lastBusquedaSeccion || lastBusquedaNombre }}"
        </h3>

        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Precio Compra</th>
              <th>Precio Venta</th>
              <th>Secci贸n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let prod of productosFiltrados">
              <td>{{ prod.id }}</td>
              <td>{{ prod.nombre }}</td>
              <td>{{ prod.precioCompra | currency }}</td>
              <td>{{ prod.precioVenta | currency }}</td>
              <td>{{ prod.seccion }}</td>
              <td>
                <button class="btn btn-danger" (click)="eliminarProducto(prod.id)"> Eliminar</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Resultado por ID -->
      <div *ngIf="productoEncontrado as p" class="result">
        <h3>Producto encontrado</h3>
        <ul>
          <li><strong>ID:</strong> {{ p.id }}</li>
          <li><strong>Nombre:</strong> {{ p.nombre }}</li>
          <li><strong>Precio Compra:</strong> {{ p.precioCompra | currency }}</li>
          <li><strong>Precio Venta:</strong> {{ p.precioVenta | currency }}</li>
          <li><strong>Secci贸n:</strong> {{ p.seccion }}</li>
        </ul>
      </div>
    </section>

    <!-- LISTA DE TODOS LOS PRODUCTOS -->
    <section class="card">
      <h2>Lista de Productos</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Precio Compra</th>
              <th>Precio Venta</th>
              <th>Secci贸n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let producto of productos">
              <td>{{ producto.id }}</td>
              <td>{{ producto.nombre }}</td>
              <td>{{ producto.precioCompra | currency }}</td>
              <td>{{ producto.precioVenta | currency }}</td>
              <td>{{ producto.seccion }}</td>
              <td>
                <button class="btn btn-danger" (click)="eliminarProducto(producto.id)"> Eliminar</button>
              </td>
            </tr>

            <tr *ngIf="productos.length === 0">
              <td colspan="6" class="empty">No hay productos registrados</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
</div>
